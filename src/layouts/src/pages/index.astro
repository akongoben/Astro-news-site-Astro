---
import NewsLayout from '../layouts/NewsLayout.astro';
import { glob } from 'glob';


// Use Vite/Node glob at build time to load markdown content
const postsImport = import.meta.glob('../content/news/**/*.md', { eager: true });


// Transform to a simple array
const posts = Object.values(postsImport).map((p) => ({
url: p.url || p.file, // Astro frontmatter may vary; ensure compatibility
frontmatter: p.frontmatter || p.attributes || {},
content: p.default ? p.default : '',
}));


// Sort by date desc
posts.sort((a, b) => new Date(b.frontmatter.date) - new Date(a.frontmatter.date));
---
<NewsLayout>
<section class="mb-6">
<h2 class="text-3xl font-bold">Latest</h2>
<p class="text-sm text-slate-500">Toggle EN / FR at the top to view posts by language.</p>
</section>


<!-- Language containers: start with EN visible -->
<div id="posts-en" class="lang-section">
<h3 class="text-2xl font-semibold mb-4">English</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
{posts.filter(p => (p.frontmatter.lang || 'en') === 'en').map(post => (
<article class="border rounded p-4">
<a href={post.frontmatter.slug ? `/news/${post.frontmatter.slug}` : post.url} class="block">
<h4 class="text-lg font-semibold">{post.frontmatter.title}</h4>
<p class="text-sm text-slate-600">{post.frontmatter.date}</p>
<p class="mt-2 text-sm text-slate-700">{post.frontmatter.description}</p>
</a>
</article>
))}
</div>
</div>


<div id="posts-fr" class="lang-section hidden">
<h3 class="text-2xl font-semibold mb-4">Fran√ßais</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
{posts.filter(p => (p.frontmatter.lang || 'en') === 'fr').map(post => (
<article class="border rounded p-4">
<a href={post.frontmatter.slug ? `/news/${post.frontmatter.slug}` : post.url} class="block">
<h4 class="text-lg font-semibold">{post.frontmatter.title}</h4>
<p class="text-sm text-slate-600">{post.frontmatter.date}</p>
<p class="mt-2 text-sm text-slate-700">{post.frontmatter.description}</p>
</a>
</article>
))}
</div>
</div>
</NewsLayout>
